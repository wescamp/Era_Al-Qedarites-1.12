#textdomain wesnoth-Bronze_Age_Clashes

# wmllint: general spellings Heal+6 Medic+ Medic++ Self-med+ Deserthome Foresthome Mountainhome Waterhome

###............................................................................................................
###                            *   A B I L I T I E S   *
###............................................................................................................

###............................................................................................................
###			K I R I O S   Beam Weapon
###............................................................................................................
#define KIRIOS_OPPOSITE_SIDE CENTER_X CENTER_Y X Y VAR
    {VARIABLE x_odd {X}}

    {VARIABLE_OP x_odd modulo 2}

    {VARIABLE c_x {CENTER_X}}
    {VARIABLE c_y {CENTER_Y}}
    {VARIABLE s_x {X}}
    {VARIABLE s_y {Y}}

    {VARIABLE result_x {CENTER_X}}
    {VARIABLE result_y {CENTER_Y}}

    {IF_VAR s_x greater_than $c_x (
        [then]
            {VARIABLE_OP result_x sub 1}
        [/then]
    )}

    {IF_VAR s_x less_than $c_x (
        [then]
            {VARIABLE_OP result_x add 1}
        [/then]
    )}

    {IF_VAR s_x equals $c_x (
        [then]
            {IF_VAR s_y less_than $c_y (
                [then]
                    {VARIABLE_OP result_y add 1}
                [/then]
            )}

            {IF_VAR s_y greater_than $c_y (
                [then]
                    {VARIABLE_OP result_y sub 1}
                [/then]
            )}
        [/then]
    )}

    {IF_VAR x_odd equals 1 (
        [then]
            {IF_VAR s_y equals $c_y (
                [then]
                    {VARIABLE_OP result_y add 1}
                [/then]
            )}
        [/then]

        [else]
            {IF_VAR s_y equals $c_y (
                [then]
                    {VARIABLE_OP result_y sub 1}
                [/then]
            )}
        [/else]
    )}
    {VARIABLE {VAR}.x $result_x}
    {VARIABLE {VAR}.y $result_y}

    {CLEAR_VARIABLE c_x}
    {CLEAR_VARIABLE c_y}
    {CLEAR_VARIABLE s_x}
    {CLEAR_VARIABLE s_y}
    {CLEAR_VARIABLE result_x}
    {CLEAR_VARIABLE result_y}
    {CLEAR_VARIABLE x_odd}
#enddef

#define KIRIOS_BEAM WEAPON DMG
    [event]
        name=attacker_hits
        first_time_only=no

        [filter_attack]
            name={WEAPON}
        [/filter_attack]

        {KIRIOS_OPPOSITE_SIDE $x2 $y2 $x1 $y1 target_hex}

        [store_unit]
            [filter]
                x,y=$target_hex.x,$target_hex.y
            [/filter]
            variable=third
        [/store_unit]

        {VARIABLE areadmg2 {DMG}}
        {VARIABLE_OP areadmg2 multiply $third[$i].resistance.fire}
        {VARIABLE_OP areadmg2 divide 100}

        [harm_unit]
            [filter]
                x,y=$target_hex.x,$target_hex.y
            [/filter]
            amount=$areadmg2
            alignment=lawful
            fire_event=yes
            animate=yes
        [/harm_unit]
        {CLEAR_VARIABLE areadmg2}
        [if]
            [have_unit]
                x,y=$target_hex.x,$target_hex.y
            [/have_unit]
            [else]
                {VARIABLE gimmexp $third[$i].level}
                {VARIABLE_OP gimmexp multiply 8}
                {VARIABLE_OP unit.experience add $gimmexp}
                {CLEAR_VARIABLE gimmexp}
                [unstore_unit]
                    variable=unit
                    find_vacant=no
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE target_hex}
        {CLEAR_VARIABLE third}
    [/event]
#enddef



################################################################################################################

###............................................................................................................
### 		Summon the Falcon bird
###  		Selectable in Game Menu
###............................................................................................................
# modified from source: Ageless_Era-data-EoMa_data-abilities-summon.cfg
#...............................................................................
#    	Summon Falcon Ability and Event
#     	Menu Item Macros
#...............................................................................
#define SUMMONFALCON_MENU_ITEM ID DESCRIPTION COST ABILITY UNIT
    [event]
        name=select
        first_time_only=no
        [filter]
            type=""
            side=$side_number
        [/filter]
        [store_unit]
            [filter]
                x,y=$x1,$y1
            [/filter]
            variable=last_selected_unit
        [/store_unit]
    [/event]
    [set_menu_item]
        id=summon_falcon_{ID}
        description= _ "Summon the {DESCRIPTION} bird ({COST}g)"
        [show_if]
        [/show_if]

        [filter_location]
            [filter_adjacent_location]
                [filter]
                    ability={ABILITY}
                    side=$side_number
                    [filter_wml]
                        moves=$this_unit.max_moves
                    [/filter_wml]
                    [filter_location]
                        [not] terrain=Ww,Wwo,Wwf,Wwr,*^Vo,*^Voa,*^Vhr,*^Vd,*^Vu,*^Vaa,*^Vm,Co,Coa,Chw,Chs,Ko,Koa,Khw,Khs,*^B*,W*,Rb,Re,Rd,Rr,Rrc,Rp,Ai,Aa,Dd,Ds,Md,Ms,Uh
                        [/not]
                    [/filter_location]
                [/filter]
            [/filter_adjacent_location]
            [not]
                [filter]
                [/filter]
                [or] terrain=_off^_usr,Qxu,Qxe,Qxua,Ql,Qlf,Mm^Xm,Md^Xm,Ms^XmW*
                [/or]
            [/not]
        [/filter_location]
        [command]
            [store_gold]
                variable=actualgold
                side=$side_number
            [/store_gold]
            [if]
                [variable]
                    name=actualgold
                    greater_than_equal_to={COST}
                [/variable]
                [then]
                    [gold]
                        amount=-{COST}
                        side=$side_number
                    [/gold]
                    [unit]
                        type={UNIT}
                        side=$side_number
                        x,y=$x1,$y1
                        moves=3
                        animate=yes
                    [/unit]
                    [store_unit]
                        variable=newunit
                        [filter]
                            x,y=$x1,$y1
                        [/filter]
                    [/store_unit]
                    [set_variable]
                        name=newunit.attacks_left
                        value=0
                    [/set_variable]
                    [unstore_unit]
                        variable=newunit
                        find_vacant=no
                    [/unstore_unit]
                    [set_variable]
                        name=newunit.moves
                        value=3
                    [/set_variable]
                    [store_unit]
                        [filter]
                            ability={ABILITY}
                            side=$side_number
                            [filter_wml]
                                moves=$this_unit.max_moves
                            [/filter_wml]
                            [filter_adjacent]
                                x,y=$x1,$y1
                            [/filter_adjacent]
                        [/filter]
                        variable=able_to_summon_falcon
                    [/store_unit]
                    [if]
                        [variable]
                            name=able_to_summon_falcon.length
                            greater_than=1
                        [/variable]
                        [then]
                            {FOREACH able_to_summon_falcon a}
                                [if]
                                    [variable]
                                        name=able_to_summon_falcon[$a].id
                                        equals=$last_selected_unit.id
                                    [/variable]
                                    [then]
                                        [set_variable]
                                            name=able_to_summon_falcon[$a].attacks_left
                                            value=0
                                        [/set_variable]
                                        [set_variable]
                                            name=able_to_summon_falcon[$a].moves
                                            value=0
                                        [/set_variable]

                                        {VARIABLE_OP able_to_summon_falcon[$a].experience add 8}

                                        [unstore_unit]
                                            variable=able_to_summon_falcon[$a]
                                            find_vacant=no
                                            text= _ "+$this_unit.level exp"
                                            red,green,blue=50,50,200
                                        [/unstore_unit]
                                        {CLEAR_VARIABLE newunit}
                                        {CLEAR_VARIABLE able_to_summon_falcon}
                                    [/then]
                                [/if]
                            {NEXT a}
                        [/then]
                        [else]
                            [store_unit]
                                variable=able_to_summon_falcon
                                [filter]
                                    ability={ABILITY}
                                    side=$side_number
                                    [filter_wml]
                                        moves=$this_unit.max_moves
                                    [/filter_wml]
                                    [filter_adjacent]
                                        x,y=$x1,$y1
                                    [/filter_adjacent]
                                [/filter]
                            [/store_unit]
                            [set_variable]
                                name=able_to_summon_falcon[$a].attacks_left
                                value=0
                            [/set_variable]
                            [set_variable]
                                name=able_to_summon_falcon[$a].moves
                                value=0
                            [/set_variable]

                            {VARIABLE_OP able_to_summon_falcon[$a].experience add 4}

                            [unstore_unit]
                                variable=able_to_summon_falcon[$a]
                                find_vacant=no
                                text= _ "+$this_unit.level exp"
                                red,green,blue=50,50,200
                            [/unstore_unit]
                            {CLEAR_VARIABLE newunit}
                            {CLEAR_VARIABLE able_to_summon_falcon}
                        [/else]
                    [/if]
                [/then]
                [else]
                    [message]
                        speaker=narrator
                        side_for=$side_number
                        caption=_ "Error"
                        message= _ "I have insufficient resources right now. I am unable to call a Falcon bird!"
                        image=wesnoth-icon.png
                    [/message]
                [/else]
            [/if]
            {CLEAR_VARIABLE actualgold}
        [/command]
    [/set_menu_item]
    ####
    ####
    [set_menu_item]
        id=summon_falcon_help
        description= _ "Summon Falcon Help"
        [show_if]
        [/show_if]

        [filter_location]
            [filter]
                type="Levite,Levite Saal,Levite Alam,Levite Taal,Levite Aluf,Kohen,Kohen Gadol"
                side=$side_number
            [/filter]
        [/filter_location]
        [command]
            [message]
                speaker=narrator
                side_for=$side_number
                caption=_ "Help"
                message= _ "To let your unit summon a Falcon bird (18 gold), right-click on adjacent hexes near a selected kabbalist.
                    
You need all movement points (and remaining attacks) to summon the Falcon.
Every call of a Falcon bird adds +4 to current experience.

If there are 2 or more units able to summon a Falcon, a Falcon will be summon by the last selected unit able to call the bird."
                image=wesnoth-icon.png
            [/message]
        [/command]
    [/set_menu_item]
#enddef

###............................................................................................................
###           Falcon bird Summoners
###............................................................................................................
#define ABILITY_FALCON_LEVEL1
    [dummy]
        id=summon_falcon_lvl1
        name= _ "Summon Falcon"
        description= _ "This unit can unleash a Falcon bird near him, but not in environments of water or ice. It will then appear on a hex next to it ready to surveill the vicinity."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=summon_falcon_lvl1
        [/have_unit]
        [then]
            {FALCON_MENU_LVL1}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=summon_falcon_lvl1
    [/filter]
    {FALCON_MENU_LVL1}
[/event]

[event]
    name=post_advance
    [filter]
        ability=summon_falcon_lvl1
    [/filter]
    {FALCON_MENU_LVL1}
[/event]

[+abilities]
#enddef

#define FALCON_MENU_LVL1
    	{SUMMONFALCON_MENU_ITEM 6_1_1 (Falcon) 7 summon_falcon_lvl1 (Falcon)}
#enddef

###............................................................................................................

#define ABILITY_FALCON_LEVEL2
    [dummy]
        id=summon_falcon_lvl2
        name= _ "Summon Falcon"
        description= _ "This unit can unleash the Elder Falcon bird near him, but not in environments of water or ice. It will then appear on a hex next to it ready to surveill the vicinity."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=summon_falcon_lvl2
        [/have_unit]
        [then]
            {FALCON_MENU_LVL2}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=summon_falcon_lvl2
    [/filter]
    {FALCON_MENU_LVL2}
[/event]

[event]
    name=post_advance
    [filter]
        ability=summon_falcon_lvl2
    [/filter]
    {FALCON_MENU_LVL2}
[/event]

[+abilities]
#enddef

#define FALCON_MENU_LVL2
	{SUMMONFALCON_MENU_ITEM 6_1_1 (Elder Falcon) 14 summon_falcon_lvl2 (Elder Falcon)}
#enddef

################################################################################################################

###............................................................................................................
### 		Summon_Jinns
###  		Selectable in Game Menu
###............................................................................................................
# modified from source: Ageless_Era-data-EoMa_data-abilities-summon.cfg
#...............................................................................
#    	Summon Jinn Ability and Event
#     	Menu Item Macros
#...............................................................................
#define JINN_MENU_ITEM ID DESCRIPTION COST ABILITY UNIT
    [event]
        name=select
        first_time_only=no
        [filter]
            type="Salik,Murshid,Qutub,Dervish,Sarkar"
            side=$side_number
        [/filter]
        [store_unit]
            [filter]
                x,y=$x1,$y1
            [/filter]
            variable=last_selected_unit
        [/store_unit]
    [/event]
    [set_menu_item]
        id=jinn_{ID}
        description= _ "Jinn {DESCRIPTION} ({COST}g)"
        [show_if]
        [/show_if]

        [filter_location]
            [filter_adjacent_location]
                [filter]
                    ability={ABILITY}
                    side=$side_number
                    [filter_wml]
                        moves=$this_unit.max_moves
                    [/filter_wml]
                    [filter_location]
                        [not] terrain=Ww,Wwo,Wwf,Wwr,*^Vo,*^Voa,*^Vhr,*^Vd,*^Vu,*^Vaa,*^Vm,Co,Coa,Chw,Chs,Ko,Koa,Khw,Khs,*^B*,W*,Rb,Re,Rd,Rr,Rrc,Rp,Ai,Aa,Uh
                        [/not]
                    [/filter_location]
                [/filter]
            [/filter_adjacent_location]
            [not]
                [filter]
                [/filter]
                [or] terrain=_off^_usr,Qxu,Qxe,Qxua,Ql,Qlf,Mm^Xm,Md^Xm,Ms^XmW*
                [/or]
            [/not]
        [/filter_location]
        [command]
            [store_gold]
                variable=actualgold
                side=$side_number
            [/store_gold]
            [if]
                [variable]
                    name=actualgold
                    greater_than_equal_to={COST}
                [/variable]
                [then]
                    [gold]
                        amount=-{COST}
                        side=$side_number
                    [/gold]
                    [unit]
                        type={UNIT}
                        side=$side_number
                        x,y=$x1,$y1
                        moves=1
                        animate=yes
                    [/unit]
                    [store_unit]
                        variable=newunit
                        [filter]
                            x,y=$x1,$y1
                        [/filter]
                    [/store_unit]
                    [set_variable]
                        name=newunit.attacks_left
                        value=0
                    [/set_variable]
                    [unstore_unit]
                        variable=newunit
                        find_vacant=no
                    [/unstore_unit]
                    [set_variable]
                        name=newunit.moves
                        value=2
                    [/set_variable]
                    [store_unit]
                        [filter]
                            ability={ABILITY}
                            side=$side_number
                            [filter_wml]
                                moves=$this_unit.max_moves
                            [/filter_wml]
                            [filter_adjacent]
                                x,y=$x1,$y1
                            [/filter_adjacent]
                        [/filter]
                        variable=able_to_jinn
                    [/store_unit]
                    [if]
                        [variable]
                            name=able_to_jinn.length
                            greater_than=1
                        [/variable]
                        [then]
                            {FOREACH able_to_jinn a}
                                [if]
                                    [variable]
                                        name=able_to_jinn[$a].id
                                        equals=$last_selected_unit.id
                                    [/variable]
                                    [then]
                                        [set_variable]
                                            name=able_to_jinn[$a].attacks_left
                                            value=0
                                        [/set_variable]
                                        [set_variable]
                                            name=able_to_jinn[$a].moves
                                            value=0
                                        [/set_variable]

                                        {VARIABLE_OP able_to_jinn[$a].experience add 4}

                                        [unstore_unit]
                                            variable=able_to_jinn[$a]
                                            find_vacant=no
                                            text= _ "+$this_unit.level exp"
                                            red,green,blue=50,50,200
                                        [/unstore_unit]
                                        {CLEAR_VARIABLE newunit}
                                        {CLEAR_VARIABLE able_to_jinn}
                                    [/then]
                                [/if]
                            {NEXT a}
                        [/then]
                        [else]
                            [store_unit]
                                variable=able_to_jinn
                                [filter]
                                    ability={ABILITY}
                                    side=$side_number
                                    [filter_wml]
                                        moves=$this_unit.max_moves
                                    [/filter_wml]
                                    [filter_adjacent]
                                        x,y=$x1,$y1
                                    [/filter_adjacent]
                                [/filter]
                            [/store_unit]
                            [set_variable]
                                name=able_to_jinn[$a].attacks_left
                                value=0
                            [/set_variable]
                            [set_variable]
                                name=able_to_jinn[$a].moves
                                value=0
                            [/set_variable]

                            {VARIABLE_OP able_to_jinn[$a].experience add 8}

                            [unstore_unit]
                                variable=able_to_jinn[$a]
                                find_vacant=no
                                text= _ "+$this_unit.level exp"
                                red,green,blue=50,50,200
                            [/unstore_unit]
                            {CLEAR_VARIABLE newunit}
                            {CLEAR_VARIABLE able_to_jinn}
                        [/else]
                    [/if]
                [/then]
                [else]
                    [message]
                        speaker=narrator
                        side_for=$side_number
                        caption=_ "Error"
                        message= _ "I have insufficient resources right now. I am unable to do summon a jinn!"
                        image=wesnoth-icon.png
                    [/message]
                [/else]
            [/if]
            {CLEAR_VARIABLE actualgold}
        [/command]
    [/set_menu_item]
    ####
    ####
    [set_menu_item]
        id=jinn_help
        description= _ "Jinn Help"
        [show_if]
        [/show_if]
        [filter_location]
            [filter]
                type="Salik,Murshid,Qutub,Dervish,Sarkar"
                side=$side_number
            [/filter]
        [/filter_location]
        [command]
            [message]
                speaker=narrator
                side_for=$side_number
                caption=_ "Help"
                message= _ "To let your unit summon a jinn, right-click on adjacent hexes near a selected shaman healer.
                    
You need all movement points (and remaining attacks) to summon one.

A new  unit can't be summoned in environments of water, ice or inhospitable mountains. Orcis and draken and undead villages or castles are too unholy to be a place for summoning a jinn at all. 
Every summoning adds +2 to current experience.

If there are 2 or more kabbalists, a new unit will be jinned by the last selected unit able to jinn."
                image=wesnoth-icon.png
            [/message]
        [/command]
    [/set_menu_item]
#enddef


###............................................................................................................
###           Jinn Summoners
###............................................................................................................
#define ABILITY_JINN_LEVEL1
    [dummy]
        id=jinn_lvl1
        name= _ "Jinn"
        description= _ "This Arab shaman healer unit can do some magic to summon a Jinn near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Jinn spirit. It will then appear on a hex next to it. Due to the level 1 of the shaman it will summon Qarin jinns."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=jinn_lvl1
        [/have_unit]
        [then]
            {JINN_MENU_LVL1}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=jinn_lvl1
    [/filter]
    {JINN_MENU_LVL1}
[/event]

[event]
    name=post_advance
    [filter]
        ability=jinn_lvl1
    [/filter]
    {JINN_MENU_LVL1}
[/event]

[+abilities]
#enddef

#define JINN_MENU_LVL1
    {JINN_MENU_ITEM 6_1_1 (Qarin) 13 jinn_lvl1 (Qarin)}
#enddef

###.............................................

#define ABILITY_JINN_LEVEL2
    [dummy]
        id=jinn_lvl2
        name= _ "Jinn"
        description= _ "This Arab shaman healer unit can do some magic to summon a Jinn near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Jinn spirit. It will then appear on a hex next to it. Due to the level 2 of the shaman it will summon Qarin and Shaytan jinns."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=jinn_lvl2
        [/have_unit]
        [then]
            {JINN_MENU_LVL2}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=jinn_lvl2
    [/filter]
    {JINN_MENU_LVL2}
[/event]

[event]
    name=post_advance
    [filter]
        ability=jinn_lvl2
    [/filter]
    {JINN_MENU_LVL2}
[/event]

[+abilities]
#enddef

#define JINN_MENU_LVL2
    {JINN_MENU_ITEM 6_2_1 (Qarin) 13 jinn_lvl2 (Qarin)}
    {JINN_MENU_ITEM 6_2_2 (Shaytan) 19 jinn_lvl2 (Shaytan)}
#enddef

###.............................................

#define ABILITY_JINN_LEVEL3
    [dummy]
        id=jinn_lvl3
        name= _ "Jinn"
        description= _ "This Arab shaman healer unit can do some magic to summon a Jinn near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Jinn spirit. It will then appear on a hex next to it. Due to the level 3 of the shaman it will summon Qarin, Shaytan, and Jinni jinns."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=jinn_lvl3
        [/have_unit]
        [then]
            {JINN_MENU_LVL3}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=jinn_lvl3
    [/filter]
    {JINN_MENU_LVL3}
[/event]

[event]
    name=post_advance
    [filter]
        ability=jinn_lvl3
    [/filter]
    {JINN_MENU_LVL3}
[/event]

[+abilities]
#enddef

#define JINN_MENU_LVL3
    {JINN_MENU_ITEM 6_3_1 (Qarin) 13 jinn_lvl3 (Qarin)}
    {JINN_MENU_ITEM 6_3_2 (Shaytan) 19 jinn_lvl3 (Shaytan)}
    {JINN_MENU_ITEM 6_3_3 (Jinni) 38 jinn_lvl3 (Jinni)}
#enddef



################################################################################################################

################################################################################################################

###............................................................................................................
### 		Summon_Baalim
###  		Selectable in Game Menu
###............................................................................................................
# modified from source: Ageless_Era-data-EoMa_data-abilities-summon.cfg
#...............................................................................
#    	Summon Baalim Ability and Event
#     	Menu Item Macros
#...............................................................................
#define BAALIM_MENU_ITEM ID DESCRIPTION COST ABILITY UNIT
    [event]
        name=select
        first_time_only=no
        [filter]
            type="Salik,Murshid,Qutub,Dervish,Sarkar"
            side=$side_number
        [/filter]
        [store_unit]
            [filter]
                x,y=$x1,$y1
            [/filter]
            variable=last_selected_unit
        [/store_unit]
    [/event]
    [set_menu_item]
        id=baalim_{ID}
        description= _ "Baalim {DESCRIPTION} ({COST}g)"
        [show_if]
        [/show_if]

        [filter_location]
            [filter_adjacent_location]
                [filter]
                    ability={ABILITY}
                    side=$side_number
                    [filter_wml]
                        moves=$this_unit.max_moves
                    [/filter_wml]
                    [filter_location]
                        [not] terrain=Ww,Wwo,Wwf,Wwr,*^Vo,*^Voa,*^Vhr,*^Vd,*^Vu,*^Vaa,*^Vm,Co,Coa,Chw,Chs,Ko,Koa,Khw,Khs,*^B*,W*,Rb,Re,Rd,Rr,Rrc,Rp,Ai,Aa,Uh
                        [/not]
                    [/filter_location]
                [/filter]
            [/filter_adjacent_location]
            [not]
                [filter]
                [/filter]
                [or] terrain=_off^_usr,Qxu,Qxe,Qxua,Ql,Qlf,Mm^Xm,Md^Xm,Ms^XmW*
                [/or]
            [/not]
        [/filter_location]
        [command]
            [store_gold]
                variable=actualgold
                side=$side_number
            [/store_gold]
            [if]
                [variable]
                    name=actualgold
                    greater_than_equal_to={COST}
                [/variable]
                [then]
                    [gold]
                        amount=-{COST}
                        side=$side_number
                    [/gold]
                    [unit]
                        type={UNIT}
                        side=$side_number
                        x,y=$x1,$y1
                        moves=1
                        animate=yes
                    [/unit]
                    [store_unit]
                        variable=newunit
                        [filter]
                            x,y=$x1,$y1
                        [/filter]
                    [/store_unit]
                    [set_variable]
                        name=newunit.attacks_left
                        value=0
                    [/set_variable]
                    [unstore_unit]
                        variable=newunit
                        find_vacant=no
                    [/unstore_unit]
                    [set_variable]
                        name=newunit.moves
                        value=2
                    [/set_variable]
                    [store_unit]
                        [filter]
                            ability={ABILITY}
                            side=$side_number
                            [filter_wml]
                                moves=$this_unit.max_moves
                            [/filter_wml]
                            [filter_adjacent]
                                x,y=$x1,$y1
                            [/filter_adjacent]
                        [/filter]
                        variable=able_to_baalim
                    [/store_unit]
                    [if]
                        [variable]
                            name=able_to_baalim.length
                            greater_than=1
                        [/variable]
                        [then]
                            {FOREACH able_to_baalim a}
                                [if]
                                    [variable]
                                        name=able_to_baalim[$a].id
                                        equals=$last_selected_unit.id
                                    [/variable]
                                    [then]
                                        [set_variable]
                                            name=able_to_baalim[$a].attacks_left
                                            value=0
                                        [/set_variable]
                                        [set_variable]
                                            name=able_to_baalim[$a].moves
                                            value=0
                                        [/set_variable]

                                        {VARIABLE_OP able_to_baalim[$a].experience add 4}

                                        [unstore_unit]
                                            variable=able_to_baalim[$a]
                                            find_vacant=no
                                            text= _ "+$this_unit.level exp"
                                            red,green,blue=50,50,200
                                        [/unstore_unit]
                                        {CLEAR_VARIABLE newunit}
                                        {CLEAR_VARIABLE able_to_baalim}
                                    [/then]
                                [/if]
                            {NEXT a}
                        [/then]
                        [else]
                            [store_unit]
                                variable=able_to_baalim
                                [filter]
                                    ability={ABILITY}
                                    side=$side_number
                                    [filter_wml]
                                        moves=$this_unit.max_moves
                                    [/filter_wml]
                                    [filter_adjacent]
                                        x,y=$x1,$y1
                                    [/filter_adjacent]
                                [/filter]
                            [/store_unit]
                            [set_variable]
                                name=able_to_baalim[$a].attacks_left
                                value=0
                            [/set_variable]
                            [set_variable]
                                name=able_to_baalim[$a].moves
                                value=0
                            [/set_variable]

                            {VARIABLE_OP able_to_baalim[$a].experience add 8}

                            [unstore_unit]
                                variable=able_to_baalim[$a]
                                find_vacant=no
                                text= _ "+$this_unit.level exp"
                                red,green,blue=50,50,200
                            [/unstore_unit]
                            {CLEAR_VARIABLE newunit}
                            {CLEAR_VARIABLE able_to_baalim}
                        [/else]
                    [/if]
                [/then]
                [else]
                    [message]
                        speaker=narrator
                        side_for=$side_number
                        caption=_ "Error"
                        message= _ "I have insufficient resources right now. I am unable to do summon a baalim!"
                        image=wesnoth-icon.png
                    [/message]
                [/else]
            [/if]
            {CLEAR_VARIABLE actualgold}
        [/command]
    [/set_menu_item]
    ####
    ####
    [set_menu_item]
        id=baalim_help
        description= _ "Baalim Help"
        [show_if]
        [/show_if]
        [filter_location]
            [filter]
                type="Salik,Murshid,Qutub,Dervish,Sarkar"
                side=$side_number
            [/filter]
        [/filter_location]
        [command]
            [message]
                speaker=narrator
                side_for=$side_number
                caption=_ "Help"
                message= _ "To let your unit summon a baalim, right-click on adjacent hexes near a selected shaman healer.
                    
You need all movement points (and remaining attacks) to summon one.

A new  unit can't be summoned in environments of water, ice or inhospitable mountains. Orcis and draken and undead villages or castles are too unholy to be a place for summoning a baalim at all. 
Every summoning adds +2 to current experience.

If there are 2 or more kabbalists, a new unit will be baalimed by the last selected unit able to baalim."
                image=wesnoth-icon.png
            [/message]
        [/command]
    [/set_menu_item]
#enddef


###............................................................................................................
###           Baalim Summoners
###............................................................................................................
#define ABILITY_BAALIM_LEVEL1
    [dummy]
        id=baalim_lvl1
        name= _ "Summon Samaritan Baalim Lv1"
        description= _ "This Arab shaman healer unit can do some magic to summon a Baalim near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Baalim spirit. It will then appear on a hex next to it. Due to the level 1 of the shaman it will summon Qarin baalims."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=baalim_lvl1
        [/have_unit]
        [then]
            {BAALIM_MENU_LVL1}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=baalim_lvl1
    [/filter]
    {BAALIM_MENU_LVL1}
[/event]

[event]
    name=post_advance
    [filter]
        ability=baalim_lvl1
    [/filter]
    {BAALIM_MENU_LVL1}
[/event]

[+abilities]
#enddef

#define BAALIM_MENU_LVL1
    {BAALIM_MENU_ITEM 6_1_1 (Qarin) 13 baalim_lvl1 (Qarin)}
#enddef

###.............................................

#define ABILITY_BAALIM_LEVEL2
    [dummy]
        id=baalim_lvl2
        name= _ "Summan Samaritan Baalim Lv2"
        description= _ "This Arab shaman healer unit can do some magic to summon a Baalim near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Baalim spirit. It will then appear on a hex next to it. Due to the level 2 of the shaman it will summon Qarin and Shaytan baalims."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=baalim_lvl2
        [/have_unit]
        [then]
            {BAALIM_MENU_LVL2}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=baalim_lvl2
    [/filter]
    {BAALIM_MENU_LVL2}
[/event]

[event]
    name=post_advance
    [filter]
        ability=baalim_lvl2
    [/filter]
    {BAALIM_MENU_LVL2}
[/event]

[+abilities]
#enddef

#define BAALIM_MENU_LVL2
    {BAALIM_MENU_ITEM 6_2_1 (Qarin) 13 baalim_lvl2 (Qarin)}
    {BAALIM_MENU_ITEM 6_2_2 (Shaytan) 19 baalim_lvl2 (Shaytan)}
#enddef

###.............................................

#define ABILITY_BAALIM_LEVEL3
    [dummy]
        id=baalim_lvl3
        name= _ "Summon Samaritan Baalim Lv3"
        description= _ "This Arab shaman healer unit can do some magic to summon a Baalim near him, but not in environments of water or ice. The unit will do forms of pagan magic in spiritual repose for a hole turn and summon the Baalim spirit. It will then appear on a hex next to it. Due to the level 3 of the shaman it will summon Qarin, Shaytan, and Baalimi baalims."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=baalim_lvl3
        [/have_unit]
        [then]
            {BAALIM_MENU_LVL3}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=baalim_lvl3
    [/filter]
    {BAALIM_MENU_LVL3}
[/event]

[event]
    name=post_advance
    [filter]
        ability=baalim_lvl3
    [/filter]
    {BAALIM_MENU_LVL3}
[/event]

[+abilities]
#enddef

#define BAALIM_MENU_LVL3
    {BAALIM_MENU_ITEM 6_3_1 (Qarin) 13 baalim_lvl3 (Qarin)}
    {BAALIM_MENU_ITEM 6_3_2 (Shaytan) 19 baalim_lvl3 (Shaytan)}
    {BAALIM_MENU_ITEM 6_3_3 (Baalimi) 38 baalim_lvl3 (Baalimi)}
#enddef



################################################################################################################

